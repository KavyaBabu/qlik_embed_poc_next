.top-ten-table {
  --cell-padding-y: var(--spacing-md);
  --cell-padding-x: var(--spacing-lg);
  padding-bottom: var(--spacing-lg);
}

.top-ten-table :global(td) {
  height: 3.5rem !important;
  min-height: auto !important;
  padding: var(--cell-padding-y) var(--cell-padding-x) !important;
  vertical-align: middle;
}

.top-ten-table :global(th) {
  height: 3rem !important;
  padding: var(--cell-padding-y) var(--cell-padding-x) !important;
  vertical-align: middle;
}

.top-ten-table__cell {
  align-items: center;
  display: flex;
  height: auto;
  min-height: 0;
}

.top-ten-table__meter {
  align-items: center;
  display: flex;
  flex: 0 0 auto;
  height: auto;
  width: 100%;
}

.top-ten-table__button {
  height: auto !important;
  line-height: 1;
  overflow: hidden;
  padding: 0 !important;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.top-ten-table__amount {
  align-items: center;
  display: flex;
  gap: var(--spacing-sm);
  height: auto;
  width: 100%;
}

.top-ten-table__bar {
  flex: 1;
  min-width: 100px;
}

.top-ten-table__value {
  color: var(--grey-900);
  flex-shrink: 0;
  font-weight: 500;
  text-align: right;
  white-space: nowrap;
}

.top-ten-table :global(th:nth-child(1)),
.top-ten-table :global(td:nth-child(1)) {
  width: 100px !important;
}

.top-ten-table :global(th:nth-child(2)),
.top-ten-table :global(td:nth-child(2)) {
  width: auto !important;
}


"use client";

import { ColumnDef } from "@tanstack/react-table";
import type { Top10MeterEntry } from "../../../models/getTop10Meters";
import {
  Button,
  HorizontalBar,
  Table,
  TruncatedText,
} from "@arqiva/react-component-lib";
import Link from "next/link";
import styles from "./index.module.css";

export const top10Columns: ColumnDef<Top10MeterEntry>[] = [
  {
    id: "label",
    header: "Meter ID",
    accessorKey: "label",
    enableSorting: false,
    size: 70,
    cell: ({ row }) => {
      return (
        <div className={styles["top-ten-table__cell"]}>
          <Table.Block.Lead className={styles["top-ten-table__meter"]}>
            <Button
              variant="text"
              asChild
              disabled
              className={styles["top-ten-table__button"]}
            >
              <Link href="#">
                <TruncatedText text={String(row.original.label)} />
              </Link>
            </Button>
          </Table.Block.Lead>
        </div>
      );
    },
  },
  {
    id: "amount",
    header: "Amount",
    accessorKey: "x",
    enableSorting: false,
    cell: ({ row, table }) => {
      const data = [
        {
          id: String(row.original.label),
          value: row.original.x,
        },
      ];

      const allRows = table.getRowModel().rows;
      const maxValue = Math.max(...allRows.map((r) => r.original.x));

      return (
        <div className={styles["top-ten-table__cell"]}>
          <div className={styles["top-ten-table__amount"]}>
            <HorizontalBar
              data={data}
              valueFormatter={(value) => `${value.toFixed(2)} KL`}
              height={28}
              maxValue={maxValue}
              className={styles["top-ten-table__bar"]}
            />
          </div>
        </div>
      );
    },
  },
];


"use client";

import { Table, DataTable } from "@arqiva/react-component-lib";
import { top10Columns } from "./columns";
import type {
  Top10MetersResponse,
  Top10MetersRequest,
} from "../../../models/getTop10Meters";
import { useTop10Meters } from "../../../hooks/useTop10Meters";
import { isQueryLoading } from "@/utils/query/isQueryLoading";
import Error from "@/lib/services/api/_components/Error";
import styles from "./index.module.css";

interface ListProps {
  queryParameters: Top10MetersRequest;
  initialData?: Top10MetersResponse;
  children?: ({
    resultsLoading,
    resultsCount,
  }: {
    resultsLoading: boolean;
    resultsCount: number;
  }) => React.ReactNode;
}

export const ListTop10Meters = ({
  queryParameters,
  initialData,
  children,
}: ListProps) => {
  const query = useTop10Meters({
    queryParameters,
    initialData,
  });

  if (query.error) {
    return (
      <Error error={query.error as Error} refetchOptions={query.refetch} />
    );
  }

  const isLoading = isQueryLoading(query);

  return (
    <div className={styles["top-ten-table"]}>
      <Table.Wrapper>
        {children?.({
          resultsLoading: isLoading,
          resultsCount: query.data?.items?.length ?? 0,
        })}

        <DataTable
          columns={top10Columns}
          data={query.data?.items ?? []}
          isLoading={isLoading}
          loader={{ pageLength: 10, widths: ["lg", "md"] }}
        />
      </Table.Wrapper>
    </div>
  );
};
