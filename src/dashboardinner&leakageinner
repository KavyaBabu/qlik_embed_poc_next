'use client';

import { Menu as MenuIcon } from 'lucide-react';
import clx from 'classnames';
import * as React from 'react';
import { useIsMobile } from '../../hooks/useIsMobile';
import Button from '../Button';
import ScrollArea from '../ScrollArea';
import Sheet from '../Sheet';
import Tooltip from '../Tooltip';
import useSidebar, { SidebarContext } from './Context';
import Group from './Group';
import styles from './index.module.css';
import Menu from './Menu';

const SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7;
const SIDEBAR_WIDTH = '16rem';
const SIDEBAR_WIDTH_MOBILE = '18rem';
const SIDEBAR_WIDTH_ICON = '4rem';
const SIDEBAR_KEYBOARD_SHORTCUT = 'b';

const Provider = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<'div'> & {
    defaultOpen?: boolean;
    open?: boolean;
    onOpenChange?: (open: boolean) => void;
    stateCookieName?: string;
  }
>(
  (
    {
      defaultOpen = true,
      open: openProp,
      onOpenChange: setOpenProp,
      className,
      style,
      children,
      stateCookieName,
      ...props
    },
    ref,
  ) => {
    const isMobile = useIsMobile();
    const [openMobile, setOpenMobile] = React.useState(false);

    const [_open, _setOpen] = React.useState(defaultOpen);
    const open = openProp ?? _open;

    // Rest of the component remains the same
    const setOpen = React.useCallback(
      (value: boolean | ((value: boolean) => boolean)) => {
        const openState = typeof value === 'function' ? value(open) : value;
        if (setOpenProp) {
          setOpenProp(openState);
        } else {
          _setOpen(openState);
        }

        // This sets the cookie to keep the sidebar state.
        if (stateCookieName)
          document.cookie = `${stateCookieName}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`;
      },
      [setOpenProp, open, stateCookieName],
    );

    // Helper to toggle the sidebar.
    const toggleSidebar = React.useCallback(() => {
      return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open);
    }, [isMobile, setOpen, setOpenMobile]);

    // Adds a keyboard shortcut to toggle the sidebar.
    React.useEffect(() => {
      const handleKeyDown = (event: KeyboardEvent) => {
        if (event.key === SIDEBAR_KEYBOARD_SHORTCUT && (event.metaKey || event.ctrlKey)) {
          event.preventDefault();
          toggleSidebar();
        }
      };

      window.addEventListener('keydown', handleKeyDown);
      return () => window.removeEventListener('keydown', handleKeyDown);
    }, [toggleSidebar]);

    // We add a state so that we can do data-state="expanded" or "collapsed".
    // This makes it easier to style the sidebar with Tailwind classes.
    const state = open ? 'expanded' : 'collapsed';

    const contextValue = React.useMemo<SidebarContext>(
      () => ({
        state,
        open,
        setOpen,
        isMobile,
        openMobile,
        setOpenMobile,
        toggleSidebar,
      }),
      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar],
    );

    return (
      <SidebarContext.Provider value={contextValue}>
        <Tooltip.Provider delayDuration={0}>
          <div
            style={
              {
                '--sidebar-width': SIDEBAR_WIDTH,
                '--sidebar-width-icon': SIDEBAR_WIDTH_ICON,
                ...style,
              } as React.CSSProperties
            }
            className={clx(styles.sidebar__provider, className)}
            ref={ref}
            {...props}
          >
            {children}
          </div>
        </Tooltip.Provider>
      </SidebarContext.Provider>
    );
  },
);
Provider.displayName = 'Provider';

const Root = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<'div'> & {
    side?: 'left' | 'right';
    collapsible?: 'offcanvas' | 'icon' | 'none';
    highlight?: boolean;
  }
>(
  (
    { side = 'left', collapsible = 'offcanvas', className, children, highlight = false, ...props },
    ref,
  ) => {
    const { isMobile, state, openMobile, setOpenMobile } = useSidebar();

    if (collapsible === 'none') {
      return (
        <div className={clx(styles.sidebar__fixed, className)} ref={ref} {...props}>
          {children}
        </div>
      );
    }

    if (isMobile) {
      return (
        <Sheet.Root open={openMobile} onOpenChange={setOpenMobile} {...props}>
          <Sheet.Content
            data-sidebar="sidebar"
            data-mobile="true"
            className={styles['sidebar__mobile']}
            style={
              {
                '--sidebar-width': SIDEBAR_WIDTH_MOBILE,
              } as React.CSSProperties
            }
            side={side}
          >
            <div className={styles['sidebar__mobile__content']}>{children}</div>
          </Sheet.Content>
        </Sheet.Root>
      );
    }

    return (
      <div
        ref={ref}
        className={styles.sidebar__desktop}
        data-state={state}
        data-collapsible={state === 'collapsed' ? collapsible : ''}
        data-side={side}
      >
        {/* This is what handles the sidebar gap on desktop */}
        <div className={clx(styles.sidebar__desktop__gap)} />
        <div
          className={clx(
            styles.sidebar__desktop__inner,
            styles[`sidebar__desktop__inner--${side}`],
            className,
          )}
          {...props}
        >
          <div
            data-sidebar="sidebar"
            data-highlight={highlight}
            className={clx(
              styles.sidebar__desktop__inner__inner,
              highlight ? styles.sidebar__desktop__inner__inner__highlight : '',
            )}
          >
            {children}
          </div>
        </div>
      </div>
    );
  },
);
Root.displayName = 'Sidebar';

const Trigger = React.forwardRef<
  React.ComponentRef<typeof Button>,
  React.ComponentProps<typeof Button>
>(({ className, onClick, ...props }, ref) => {
  const { toggleSidebar } = useSidebar();

  return (
    <Button
      ref={ref}
      data-sidebar="trigger"
      variant="ghost"
      size="md"
      className={clx(styles.sidebar__trigger, className)}
      onClick={(event) => {
        onClick?.(event);
        toggleSidebar();
      }}
      {...props}
    >
      <MenuIcon />
      <span className="sr-only">Toggle Sidebar</span>
    </Button>
  );
});
Trigger.displayName = 'Trigger';

const Inset = React.forwardRef<HTMLDivElement, React.ComponentProps<'main'>>(
  ({ className, ...props }, ref) => {
    return <main ref={ref} className={clx(styles.sidebar__inset, className)} {...props} />;
  },
);
Inset.displayName = 'Inset';

const Header = React.forwardRef<HTMLDivElement, React.ComponentProps<'div'>>(
  ({ className, ...props }, ref) => {
    return (
      <div
        ref={ref}
        data-sidebar="header"
        className={clx(styles.sidebar__header, className)}
        {...props}
      />
    );
  },
);
Header.displayName = 'Header';

const Footer = React.forwardRef<HTMLDivElement, React.ComponentProps<'div'>>(
  ({ className, ...props }, ref) => {
    return (
      <div
        ref={ref}
        data-sidebar="footer"
        className={clx(styles.sidebar__footer, className)}
        {...props}
      />
    );
  },
);
Footer.displayName = 'Footer';

const Content = React.forwardRef<HTMLDivElement, React.ComponentProps<'div'>>(
  ({ className, children, ...props }, ref) => {
    return (
      <div
        ref={ref}
        data-sidebar="content"
        className={clx(styles.sidebar__content, className)}
        {...props}
      >
        <ScrollArea.Root className={styles['sidebar__content__scroll']}>
          <ScrollArea.Viewport>{children}</ScrollArea.Viewport>
          <ScrollArea.Bar orientation="vertical" />
        </ScrollArea.Root>
      </div>
    );
  },
);
Content.displayName = 'Content';

const Sidebar = {
  Root,
  Content,
  Footer,
  Group,
  Header,
  Inset,
  Menu,
  Provider,
  Trigger,
  useSidebar,
};

export default Sidebar;


.sidebar__provider {
  background-color: var(--grey-25);
  display: flex;
  min-height: 100vh;
  width: 100%;
}

.sidebar__fixed {
  display: flex;
  flex-direction: column;
  height: 100%;
  width: var(--sidebar-width);
}

.sidebar__mobile {
  padding: 0;
  width: var(--sidebar-width);
}

.sidebar__mobile__content {
  display: flex;
  flex-direction: column;
  height: 100%;
  width: 100%;
}

.sidebar__desktop {
  display: none;

  @media (width >= 768px) {
    display: block;
  }
}

.sidebar__desktop__gap {
  background-color: transparent;
  position: relative;
  transition-duration: var(--transition-time-fast);
  width: var(--sidebar-width);
}

.sidebar__desktop__inner {
  bottom: 0;
  display: none;
  padding-bottom: var(--spacing-xs);
  padding-left: var(--spacing-xs);
  padding-top: var(--spacing-xs);
  position: fixed;
  top: 0;
  transition-duration: var(--transition-time-fast);
  width: var(--sidebar-width);
  z-index: 10;

  @media (width >= 768px) {
    display: flex;
  }
}

.sidebar__content {
  display: flex;
  flex: 1 1 0%;
  flex-direction: column;
  gap: var(--spacing-md);
  min-height: 0;
  overflow: hidden;
}

.sidebar__group__label {
  align-items: center;
  border-radius: var(--radius-sm);
  display: flex;
  flex-shrink: 0;
  font: var(--text-xs);
  height: var(--spacing-4xl);
  outline-style: none;
  padding-left: var(--spacing-md);
  padding-right: var(--spacing-md);
  transition-duration: var(--transition-time-fast);
  white-space: nowrap;

  & svg {
    flex-shrink: 0;
    height: var(--spacing-xl);
    width: var(--spacing-xl);
  }
}

.sidebar__group__action {
  align-items: center;
  aspect-ratio: 1 / 1;
  border-radius: var(--radius-sm);
  display: flex;
  justify-content: center;
  outline-style: none;
  padding: 0;
  position: absolute;
  right: var(--spacing-xl);
  top: var(--spacing-xl);
  transition-duration: var(--transition-time);
  transition-property: transform;
  width: var(--spacing-2xl);

  & svg {
    flex-shrink: 0;
    height: var(--spacing-xl);
    width: var(--spacing-xl);
  }
}

.sidebar__menu__button {
  align-items: center;
  background-color: transparent;
  border: none;
  border-radius: var(--radius-sm);
  display: flex;
  font: var(--text-sm);
  gap: var(--spacing-lg);
  outline-style: none;
  overflow: hidden;
  padding: var(--spacing-md) var(--spacing-lg);
  text-align: left;
  transition: background-color var(--transition-time);
  white-space: nowrap;
  width: 100%;

  &[data-active="true"] {
    background-color: var(--primary-100);
  }

  &:hover,
  &[data-active="true"]:hover {
    background-color: var(--grey-100);
  }

  &:focus-visible {
    outline: var(--primary-500) solid 1px;
  }

  & svg {
    color: var(--grey-500);
    flex-shrink: 0;
    height: var(--spacing-xl);
    width: var(--spacing-xl);
  }
}

.sidebar__menu__badge {
  align-items: center;
  border-radius: var(--radius-sm);
  display: flex;
  font: var(--text-xs);
  height: var(--spacing-2xl);
  justify-content: center;
  padding-left: var(--spacing-xs);
  padding-right: var(--spacing-xs);
  pointer-events: none;
  position: absolute;
  right: var(--spacing-xs);
  user-select: none;
}

.sidebar__menu__sub { 
  --transform-translate-x: 1px; 

  border-left: 1px solid var(--grey-200);
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
  list-style: none;
  margin-bottom: var(--spacing-md);
  margin-left: var(--spacing-2xl);
  margin-top: var(--spacing-sm);
  min-width: 0;
  padding: var(--spacing-xxs) 0.625rem;
  padding: 0;
}

.sidebar__menu__sub__button {
  align-items: center;
  border-radius: var(--radius-sm);
  display: flex;
  font: var(--text-sm);
  gap: var(--spacing-md);
  margin-left: var(--spacing-sm);
  min-width: 0;
  outline-style: none;
  overflow: hidden;
  padding: var(--spacing-sm) var(--spacing-2xl);
  transition: background-color var(--transition-time);

  & svg {
    flex-shrink: 0;
    height: var(--spacing-xl);
    width: var(--spacing-xl);
  }

  &[data-active="true"] {
    background-color: var(--primary-50);
  }

  &:hover,
  &[data-active="true"]:hover {
    background-color: var(--grey-100);
  }

  &:focus-visible {
    outline: var(--primary-500) solid 1px;
  }
}

.sidebar__desktop[data-collapsible="icon"] {
  .sidebar__desktop__inner,
  .sidebar__desktop__gap {
    width: var(--sidebar-width-icon);
  }

  .sidebar__content {
    overflow: hidden;
  }

  .sidebar__group__label {
    margin-top: calc(var(--spacing-4xl) * -1);
    opacity: 0;
    visibility: hidden;
  }

  .sidebar__menu__button {
    width: var(--spacing-5xl);
  }

  .sidebar__group__action,
  .sidebar__menu__action,
  .sidebar__menu__badge,
  .sidebar__menu__sub,
  .sidebar__menu__sub__button {
    display: none;
  }
}

.sidebar__desktop__inner--left {
  left: 0;
}

.sidebar__desktop__inner--right {
  right: 0;
}

.sidebar__desktop__inner__inner {
  background-color: var(--white);
  border: 1px solid var(--grey-200);
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow-md);
  display: flex;
  flex-direction: column;
  height: 100%;
  width: 100%;
}

.sidebar__desktop__inner__inner__highlight {
  background-color: var(--primary-200);
}

button.sidebar__trigger {
  height: var(--spacing-4xl);
  position: fixed;
  width: var(--spacing-4xl);
  z-index: 10;
}

.sidebar__inset {
  display: flex;
  flex: 1 1 0%;
  flex-direction: column;
  overflow: hidden;
  position: relative;
}

.sidebar__header {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
  padding: var(--spacing-md);
}

.sidebar__footer {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
  padding: var(--spacing-md);
}

.sidebar__content__scroll {
  max-height: 100%;
  padding-right: var(--spacing-md);
}

.sidebar__group {
  display: flex;
  flex-direction: column;
  min-width: 0;
  padding: var(--spacing-md);
  position: relative;
  width: 100%;
}

.sidebar__group__content {
  width: 100%;
}

.sidebar__menu {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xs);
  list-style: none;
  min-width: 0;
  width: 100%;
}

.sidebar__menu__item {
  position: relative;
}

button.sidebar__menu__action {
  align-items: center;
  aspect-ratio: 1 / 1;
  background-color: transparent;
  border: none;
  border-radius: var(--radius-sm);
  display: flex;
  justify-content: center;
  outline-style: none;
  padding: 0;
  position: absolute;
  right: var(--spacing-sm);
  top: var(--spacing-md);
  transition-duration: var(--transition-time);
  transition-property: transform;
  width: var(--spacing-2xl);

  & svg {
    flex-shrink: 0;
    height: var(--spacing-xl);
    width: var(--spacing-xl);
  }
}

button.sidebar__menu__action--show-on-hover {
  opacity: 0;
  transition: opacity var(--transition-time);

  &[data-state="open"],
  &:focus,
  &:focus-visible {
    opacity: 1;
  }
}

.sidebar__menu__item:hover {
  .sidebar__menu__action--show-on-hover {
    opacity: 1;
  }
}

.sidebar__menu__skeleton {
  align-items: center;
  border-radius: var(--radius-sm);
  display: flex;
  gap: var(--spacing-md);
  height: var(--spacing-4xl);
  padding-left: var(--spacing-md);
  padding-right: var(--spacing-md);
}

.sidebar__menu__skeleton__icon {
  border-radius: var(--radius-sm);
}

.sidebar__menu__skeleton__text {
  flex: 1 1 0%;
  height: var(--spacing-xl);
  max-width: var(--skeleton-width);
}


"use client";

import { Page, Card } from "@arqiva/react-component-lib";
import QueryParamsUrlProvider from "@/app/_components/QueryParamsUrlProvider";
import DashboardInner, { DashboardFilters } from "./Inner";
import LeakageListPage from "./widgets/leakageList/page";
import { useEffect, useState } from "react";
import styles from "./index.module.css";

const DashboardPage = () => {
  const [dashboardFilters, setDashboardFilters] = useState<DashboardFilters>({});
  const [mounted, setMounted] = useState(false);

  useEffect(() => {
    setMounted(true);
  }, []);

  if (!mounted) {
    return null;
  }
  
  return (
    <Page.Root>
  <QueryParamsUrlProvider initialParams={{}}>
    <div className={styles.dashboardFiltersFixedBar}>
      <div className={styles.dashboardFiltersInner}>
        <h1 className={styles.dashboardTitle}>Dashboard</h1>
        <DashboardInner.FiltersBar onFiltersChange={setDashboardFilters} />
      </div>
    </div>
    <div className={styles["dashboard__content-wrapper"]}>
      <DashboardInner.Content />
      <div className={styles["dashboard--full-width"]}>
        <h2 className={styles["dashboard__section-heading"]}>Leakage List</h2>
        <LeakageListPage dashboardFilters={dashboardFilters} />
      </div>
    </div>
  </QueryParamsUrlProvider>
</Page.Root>
  );
};

export default DashboardPage;

"use client";

import { useEffect } from "react";
import { QueryParams, useQueryParams } from "@arqiva/react-component-lib";
import {
  GroupFilter,
  groupFilterOverride,
} from "@/lib/services/api/dashboard/Kpis/filters/GroupFilter";
import {
  DateRangeFilter,
  dateRangeFilterOverride,
} from "@/lib/services/api/dashboard/Kpis/filters/DateRangeFilter";
import {
  TimeFilter,
  timeFilterOverride,
} from "@/lib/services/api/dashboard/Kpis/filters/TimeFilter";
import {
  ConsumptionFilter,
  consumptionFilterOverride,
} from "@/lib/services/api/dashboard/Kpis/filters/ConsumptionFilter";
import MeterConsumptionPage from "./widgets/meterConsumption/page";
import LeakagePage from "./widgets/leakgaeInfo/page";
import Top10MeterPage from "./widgets/top10Meters/page";
import FlowValuesInner from "./widgets/flowValues/Inner";
import styles from "./index.module.css";

export interface DashboardFilters {
  group_id?: string;
  dateRange?: string;
  timeRange?: string;
  consumption_range?: string;
}

interface FiltersBarProps {
  onFiltersChange: (filters: DashboardFilters) => void;
}

const FiltersBar = ({ onFiltersChange }: FiltersBarProps) => {
  const { queryParams } = useQueryParams();

  useEffect(() => {
    onFiltersChange({
      group_id: queryParams.group_id ? String(queryParams.group_id) : undefined,
      dateRange: queryParams.dateRange
        ? String(queryParams.dateRange)
        : undefined,
      timeRange: queryParams.timeRange
        ? String(queryParams.timeRange)
        : undefined,
      consumption_range: queryParams.consumption_range
        ? String(queryParams.consumption_range)
        : undefined,
    });
  }, [
    queryParams.group_id,
    queryParams.dateRange,
    queryParams.timeRange,
    queryParams.consumption_range,
    onFiltersChange,
  ]);

  return (
    <div className={styles.dashboard__filters}>
      <QueryParams.Params.Filters>
        <GroupFilter />
        <DateRangeFilter />
        <TimeFilter />
        <ConsumptionFilter />
      </QueryParams.Params.Filters>
      <QueryParams.Params.SelectedValues
        resultsLoading={false}
        resultsCount={0}
        filterOverrides={{
          ...groupFilterOverride,
          ...dateRangeFilterOverride,
          ...timeFilterOverride,
          ...consumptionFilterOverride,
        }}
        filterIgnoreList={["q"]}
      />
    </div>
  );
};

const Content = () => (
  <section className={styles.dashboard}>
    <div className={styles["dashboard--full-width"]}>
      <h2 className={styles["dashboard__section-heading"]}>
        Meter Consumption
      </h2>
      <MeterConsumptionPage />
    </div>
    <div className={styles["dashboard--full-width"]}>
      <h2 className={styles["dashboard__section-heading"]}>Leakage</h2>
      <LeakagePage />
    </div>
    <div className={styles["dashboard__split-row"]}>
      <div className={styles["dashboard__main-column"]}>
        <h2 className={styles["dashboard__section-heading"]}>Top 10 Meters</h2>
        <Top10MeterPage />
      </div>
      <div className={styles["dashboard__side-column"]}>
        <h2 className={styles["dashboard__section-heading"]}>Flow Values</h2>
        <FlowValuesInner />
      </div>
    </div>
  </section>
);

const DashboardInner = { FiltersBar, Content };
export default DashboardInner;



.dashboardFiltersFixedBar {
  position: fixed;
  top: 0;
  width: calc(100vw - var(--sidebar-width, 16rem));
  z-index: 1001;
  background: #fff;
  box-shadow: 0 2px 8px rgba(0,0,0,0.10);
  border-bottom: 1px solid #f1f1f1;
}

.dashboardFiltersInner {
  display: flex;
  flex-direction: column;
  gap: 1.25rem;
}

.dashboardTitle {
  font-size: 2rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
}

/* Push page content below the fixed bar */
.dashboard__content-wrapper {
  padding-top: 140px; /* matches the height of .dashboardFiltersFixedBar + some gap */
  width: 100%;
}


.dashboard__filters-bar-wrapper > * {
  overflow: visible !important;
}

.dashboard__filters-bar-wrapper div {
  overflow: visible !important;
}

.sidebar__desktop[data-collapsible="icon"] ~ .sidebar__inset .dashboard__filters-bar-wrapper {
  margin-left: calc(var(--sidebar-width-icon) + var(--spacing-xs));
}

@media (width < 768px) {
  .dashboard__filters-bar-wrapper {
    left: var(--spacing-xs);
    right: var(--spacing-xs);
    width: calc(100% - var(--spacing-xs) * 2);
    top: var(--spacing-xs);
  }
}

.dashboard__filters-header {
  margin-bottom: var(--spacing-md);
}

.dashboard__filters-header h1 {
  margin: 0;
  font-size: var(--text-lg, 1.125rem);
  font-weight: var(--font-semibold, 600);
}

.dashboard__content-wrapper {
  padding-top: 100px;
  width: 100%;
}

.dashboard__section-heading {
  color: var(--grey-900, #111827);
  font-size: var(--text-xl, 1.25rem);
  font-weight: var(--font-semibold, 600);
  line-height: 1.5;
  margin-bottom: var(--spacing-lg, 1rem);
}

.dashboard--full-width {
  width: 100%;
}

.dashboard__split-row {
  display: grid;
  gap: var(--spacing-xl, 1.5rem);
  grid-template-columns: 60% 40%;
  width: 100%;
}

.dashboard__main-column {
  min-width: 0;
}

.dashboard__side-column {
  min-width: 0;
}

@media (width <= 1024px) {
  .dashboard__split-row {
    gap: var(--spacing-lg, 1rem);
    grid-template-columns: 65% 35%;
  }
}

@media (width < 768px) {
  .dashboard__filters-bar-wrapper {
    margin-left: var(--spacing-xs);
    margin-right: var(--spacing-xs);
  }
}

@media (width <= 480px) {
  .dashboard__content-wrapper {
    padding-top: 140px;
  }
}

import { LogOut } from "lucide-react";
import type { Metadata } from "next";
import GAConfig from "@/lib/services/GA/components/GAConfig";
import Logout from "../_components/Logout";
import Navigation from "./_components/Navigation";
import SessionExpiredAlertDialog from "./_components/SessionExpiredAlertDialog";

export const metadata: Metadata = {
  title: "Dashboard",
  description: "Dashboard for Authenticated users",
};

export default function Layout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <>
      <GAConfig />
      <Navigation
        logout={
          <Logout variant="text">
            <LogOut />
            Log out
          </Logout>
        }
      >
        {children}
      </Navigation>
      <SessionExpiredAlertDialog />
    </>
  );
}

import { cookies } from "next/headers";
import NavigationInner from "./Inner";

const NAVIGATION_COOKIE_STATE = "main_nav:state";

const Navigation = async ({
  children,
  logout,
}: Pick<
  React.ComponentProps<typeof NavigationInner>,
  "children" | "logout"
>) => {
  const cookieStore = await cookies();
  const sidebarState =
    cookieStore.get(NAVIGATION_COOKIE_STATE)?.value === "true";

  return (
    <NavigationInner
      logout={logout}
      defaultOpen={sidebarState}
      stateCookieName={NAVIGATION_COOKIE_STATE}
    >
      {children}
    </NavigationInner>
  );
};

export default Navigation;

"use client";

import { Sidebar, SidebarTemplates } from "@arqiva/react-component-lib";
import { House, CircleQuestionMark, Gauge } from "lucide-react";
import Link from "next/link";
import { usePathname } from "next/navigation";
import routes from "@/lib/routes";
import Logo from "./Logo";

interface NavigationInnerProps
  extends React.ComponentProps<typeof Sidebar.Provider> {
  logout?: React.ReactNode;
  children?: React.ReactNode;
  defaultOpen?: boolean;
  stateCookieName?: string;
}

const NavigationInner = ({
  children,
  defaultOpen,
  stateCookieName,
  logout,
}: NavigationInnerProps) => {
  const pathname = usePathname();

  const getDashboardCurrentPath = () => {
    if (
      pathname === routes.dashboard.root ||
      pathname.startsWith(routes.dashboard.groups.root)
    ) {
      return routes.dashboard.root;
    }
    return;
  };

  return (
    <Sidebar.Provider
      stateCookieName={stateCookieName}
      defaultOpen={defaultOpen}
      style={{
        "--sidebar-width": "16rem",
        "--sidebar-width-icon": "4rem",
      } as React.CSSProperties}
    >
      <Sidebar.Root collapsible="icon">
        <Sidebar.Header>
          <Logo />
        </Sidebar.Header>
        <Sidebar.Content>
          <Sidebar.Group.Root>
            <Sidebar.Group.Content>
              <Sidebar.Menu.Root>
                <SidebarTemplates.CollapsibleMenuItem.Root
                  linkComponent={Link}
                  currentPath={getDashboardCurrentPath()}
                  title="Dashboard"
                  url={routes.dashboard.root}
                  icon={<House />}
                >
                  <SidebarTemplates.CollapsibleMenuItem.SubItem
                    linkComponent={Link}
                    currentPath={
                      pathname.startsWith(routes.dashboard.groups.root)
                        ? routes.dashboard.groups.root
                        : ""
                    }
                    url={routes.dashboard.groups.root}
                  >
                    Groups
                  </SidebarTemplates.CollapsibleMenuItem.SubItem>
                </SidebarTemplates.CollapsibleMenuItem.Root>

                <SidebarTemplates.SimpleMenuItem
                  linkComponent={Link}
                  currentPath={pathname}
                  title="Meters"
                  url={routes.dashboard.meters}
                  icon={<Gauge />}
                />
              </Sidebar.Menu.Root>
            </Sidebar.Group.Content>
          </Sidebar.Group.Root>
        </Sidebar.Content>
        <Sidebar.Footer>
          <Sidebar.Menu.Root>
            <SidebarTemplates.SimpleMenuItem
              linkComponent={Link}
              currentPath={pathname}
              title="Support"
              url={routes.dashboard.support}
              icon={<CircleQuestionMark />}
            />
          </Sidebar.Menu.Root>
        </Sidebar.Footer>
      </Sidebar.Root>
      <Sidebar.Inset>
        <Sidebar.Trigger />
        {children}
      </Sidebar.Inset>
    </Sidebar.Provider>
  );
};

export default NavigationInner;


:root {
  --background: #ffffff;
  --foreground: #171717;
}

@media (prefers-color-scheme: dark) {
  :root {
    --background: #0a0a0a;
    --foreground: #ededed;
  }
}

html,
body {
  max-width: 100vw;
  overflow-x: hidden;
}

body {
  background: var(--background);
  color: var(--foreground);
  font-family: Arial, Helvetica, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

a {
  color: inherit;
  text-decoration: none;
}

@media (prefers-color-scheme: dark) {
  html {
    color-scheme: dark;
  }
}

[data-radix-popover-content] {
  z-index: 50 !important;
}

[data-radix-dialog-content] {
  z-index: 50 !important;
}

.popover-content,
[role="tooltip"],
[role="dialog"],
[role="listbox"],
[role="menu"],
[role="combobox"] {
  z-index: 50 !important;
}

[data-radix-popover-content] {
  z-index: 50 !important;
}

[data-radix-popover-content] {
  z-index: 50 !important;
}


'use client';

import dayjs from 'dayjs';
import advancedFormat from 'dayjs/plugin/advancedFormat';
import { useState, useEffect, memo, useCallback, useMemo } from 'react';
import { DateRange } from 'react-day-picker';
import Button from '../../Button';
import Calendar from '../../Calendar';
import Popover from '../../Popover';
import { Calendar as CalendarIcon } from 'lucide-react';
import clx from 'classnames';
import inputStyles from '../input.module.css';
import styles from './index.module.css';
import { useQueryParams } from '../../QueryParams';
import { displayDate } from 'src/utils/dateTime';

dayjs.extend(advancedFormat);

interface DateRangePickerProps {
  className?: string;
  clearable?: boolean;
  placeholder?: string;
  initialRange?: DateRange;
  onSelect?: (range?: DateRange | undefined) => void;
}

const DateRangePickerComponent = ({
  className,
  clearable = true,
  placeholder = 'Pick a date range',
  initialRange,
  onSelect,
}: DateRangePickerProps) => {
  const { queryParams, setParam } = useQueryParams<{ dateRange?: string }>();
  const [range, setRange] = useState<DateRange | undefined>(initialRange);
  const [month, setMonth] = useState<Date | undefined>(
    () => initialRange?.from ?? initialRange?.to ?? undefined,
  );

  useEffect(() => {
    if (!queryParams.dateRange) return setRange(undefined);
    const [from, to] = queryParams.dateRange.split('_to_');
    setRange({
      from: from ? new Date(from) : undefined,
      to: to ? new Date(to) : undefined,
    });
  }, [queryParams.dateRange]);

  const handleSelect = useCallback(
    (selected?: DateRange) => {
      setRange(selected);
      if (selected?.from) setMonth(selected.from);
      if (selected?.from && selected?.to) {
        setParam('dateRange', `${selected.from.toISOString()}_to_${selected.to.toISOString()}`);
      } else if (selected?.from) {
        setParam('dateRange', `${selected.from.toISOString()}_to_`);
      } else {
        setParam('dateRange', undefined);
      }
      onSelect?.(selected);
    },
    [setParam, onSelect],
  );

  const handleDayClick = useCallback(
    (day: Date) => {
      setMonth(day);
      if (!range?.from || range?.to) {
        const newRange = { from: day, to: undefined };
        setRange(newRange);
        setParam('dateRange', `${day.toISOString()}_to_`);
        onSelect?.(newRange);
      }
    },
    [range, setParam, onSelect],
  );

  const handleClear = useCallback(() => {
    setRange(undefined);
    setParam('dateRange', undefined);
    onSelect?.();
  }, [setParam, onSelect]);

  const displayLabel = useMemo(() => {
    if (range?.from && range?.to) return `${displayDate(range.from)} - ${displayDate(range.to)}`;
    if (range?.from) return `${displayDate(range.from)} - ...`;
    return placeholder;
  }, [range, placeholder]);

  return (
    <Popover.Root>
      <Popover.Trigger asChild>
        <Button variant="secondary" className={clx(inputStyles.input, className)}>
          <CalendarIcon size={16} />
          {displayLabel}
          {clearable && range?.from && (
            <span
              className={styles['date-range-picker__clear-button']}
              onClick={(e) => {
                e.stopPropagation();
                handleClear();
              }}
              onKeyDown={(e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                  e.preventDefault();
                  e.stopPropagation();
                  handleClear();
                }
              }}
              tabIndex={0}
              aria-label="Clear date range"
            >
              âœ•
            </span>
          )}
        </Button>
      </Popover.Trigger>
      <Popover.Content align="start">
        <div>
          <Calendar
            mode="range"
            numberOfMonths={2}
            selected={range}
            month={month}
            onMonthChange={setMonth}
            onSelect={handleSelect}
            onDayClick={handleDayClick}
            classNames={{
              months: styles['date-range-picker__months-row'],
            }}
          />
        </div>
      </Popover.Content>
    </Popover.Root>
  );
};

export const DateRangePicker = memo(DateRangePickerComponent);
DateRangePicker.displayName = 'DateRangePicker';

export default DateRangePicker;

"use client";

import { DateRangePicker, useQueryParams } from "@arqiva/react-component-lib";
import { memo, useMemo, useCallback } from "react";
import { displayDate } from "@/utils/dateTime";

export const DateRangeFilter = memo(() => {
  const { queryParams, setParam } = useQueryParams<{ dateRange?: string }>();

  const initialRange = useMemo(() => {
    if (!queryParams.dateRange) return;
    const [fromStr, toStr] = queryParams.dateRange.split("_to_");
    const from = fromStr ? new Date(fromStr) : undefined;
    const to = toStr ? new Date(toStr) : undefined;

    return {
      from: from && !Number.isNaN(from.getTime()) ? from : undefined,
      to: to && !Number.isNaN(to.getTime()) ? to : undefined,
    };
  }, [queryParams.dateRange]);

  const handleSelect = useCallback(
    (range?: { from?: Date; to?: Date }) => {
      if (range?.from && range.to) {
        setParam(
          "dateRange",
          `${range.from.toISOString()}_to_${range.to.toISOString()}`
        );
      } else if (range?.from) {
        setParam("dateRange", `${range.from.toISOString()}_to_`);
      } else {
        setParam("dateRange", undefined);
      }
    },
    [setParam]
  );

  return (
    <DateRangePicker
      initialRange={initialRange}
      clearable
      placeholder="Pick a date range"
      onSelect={handleSelect}
    />
  );
});

DateRangeFilter.displayName = "DateRangeFilter";

export const dateRangeFilterOverride = {
  dateRange: {
    label: "Date Range",
    valueTransform: (value: string | number) => {
      if (!value || typeof value !== "string") return String(value);
      const [from, to] = value.split("_to_");
      return from && to
        ? `${displayDate(from)} - ${displayDate(to)}`
        : from
          ? `${displayDate(from)} - ...`
          : "Pick a date range";
    },
  },
};

export default DateRangeFilter;
